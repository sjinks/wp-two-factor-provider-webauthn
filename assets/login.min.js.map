{"version":3,"file":"login.min.js","sources":["lang.ts","common.ts","login.ts"],"sourcesContent":["import { __ } from '@wordpress/i18n';\nexport const L_WEBAUTHN_NOT_SUPPORTED = __('WebAuthn is not supported by the browser.', 'two-factor-provider-webauthn');\nexport const L_UNABLE_TO_GET_PK_CREDENTIAL = __('Unable to get a public key credential.', 'two-factor-provider-webauthn');\nexport const L_NOT_ALLOWED_ERROR = __('The request is not allowed.', 'two-factor-provider-webauthn');\nexport const L_SECURITY_ERROR = __('The operation is insecure.', 'two-factor-provider-webauthn');\nexport const L_NOT_SUPPORTED_ERROR = __('The operation is not supported.', 'two-factor-provider-webauthn');\nexport const L_ABORT_ERROR = __('The operation was canceled.', 'two-factor-provider-webauthn');\nexport const L_UNKNOWN_KEY = __('You cannot use this key to log in.', 'two-factor-provider-webauthn');\nexport const L_KEY_ALREADY_REGISTERED = __('This key is already registered.', 'two-factor-provider-webauthn');\nexport const L_UNKNOWN_ERROR = __('This key is already registered.', 'two-factor-provider-webauthn');\nexport const L_FETCHING_REG_INFO = __('Fetching registration information…', 'two-factor-provider-webauthn');\nexport const L_GENERATING_CREDENTIALS = __('Generating credentials…', 'two-factor-provider-webauthn');\nexport const L_REGISTERING_CREDENTIALS = __('Registering credentials…', 'two-factor-provider-webauthn');\nexport const L_FAILED_TO_CREATE_CREDENTIALS = __('Unable to create public key credentials', 'two-factor-provider-webauthn');\nexport const L_KEY_REGISTERED = __('The key has been registered.', 'two-factor-provider-webauthn');\nexport const L_SENDING_REQUEST = __('Sending request…', 'two-factor-provider-webauthn');\nexport const L_KEY_REVOKED = __('The key has been revoked.', 'two-factor-provider-webauthn');\nexport const L_KEY_RENAMED = __('The key has been renamed.', 'two-factor-provider-webauthn');\n//# sourceMappingURL=lang.js.map","import { L_NOT_ALLOWED_ERROR, L_SECURITY_ERROR, L_NOT_SUPPORTED_ERROR, L_ABORT_ERROR, L_UNKNOWN_KEY, L_KEY_ALREADY_REGISTERED, } from './lang';\nfunction arrayToBase64String(a) {\n    return window.btoa(String.fromCharCode(...a));\n}\nfunction base64UrlDecode(input) {\n    return window.atob(input.replace(/-/g, '+').replace(/_/g, '/') + '='.repeat(3 - ((3 + input.length) % 4)));\n}\nfunction stringToBuffer(s) {\n    return Uint8Array.from(s, (c) => c.charCodeAt(0));\n}\nexport function preparePublicKeyCreationOptions(publicKey) {\n    var _a;\n    return {\n        ...publicKey,\n        user: {\n            ...publicKey.user,\n            id: stringToBuffer(base64UrlDecode(publicKey.user.id)),\n        },\n        challenge: stringToBuffer(base64UrlDecode(publicKey.challenge)),\n        excludeCredentials: (_a = publicKey.excludeCredentials) === null || _a === void 0 ? void 0 : _a.map((data) => ({\n            ...data,\n            id: stringToBuffer(base64UrlDecode(data.id)),\n        })),\n    };\n}\nexport function preparePublicKeyCredentialRequestOptions(publicKey) {\n    var _a;\n    return {\n        ...publicKey,\n        challenge: stringToBuffer(base64UrlDecode(publicKey.challenge)),\n        allowCredentials: (_a = publicKey.allowCredentials) === null || _a === void 0 ? void 0 : _a.map((data) => ({\n            ...data,\n            id: stringToBuffer(base64UrlDecode(data.id)),\n        })),\n    };\n}\nexport function preparePublicKeyCredential(data) {\n    const response = data.response;\n    return {\n        id: data.id,\n        type: data.type,\n        rawId: arrayToBase64String(new Uint8Array(data.rawId)),\n        clientExtensionResults: data.getClientExtensionResults(),\n        response: {\n            attestationObject: 'attestationObject' in response\n                ? arrayToBase64String(new Uint8Array(response.attestationObject))\n                : undefined,\n            authenticatorData: 'authenticatorData' in response\n                ? arrayToBase64String(new Uint8Array(response.authenticatorData))\n                : undefined,\n            signature: 'signature' in response ? arrayToBase64String(new Uint8Array(response.signature)) : undefined,\n            userHandle: 'userHandle' in response && response.userHandle\n                ? arrayToBase64String(new Uint8Array(response.userHandle))\n                : undefined,\n            clientDataJSON: arrayToBase64String(new Uint8Array(data.response.clientDataJSON)),\n        },\n    };\n}\nexport function decodeDOMException(e, isAuth) {\n    switch (e.name) {\n        case 'NotAllowedError':\n            return L_NOT_ALLOWED_ERROR;\n        case 'SecurityError':\n            return L_SECURITY_ERROR;\n        case 'NotSupportedError':\n            return L_NOT_SUPPORTED_ERROR;\n        case 'AbortError':\n            return L_ABORT_ERROR;\n        case 'InvalidStateError':\n            return isAuth ? L_UNKNOWN_KEY : L_KEY_ALREADY_REGISTERED;\n        default:\n            return e.message;\n    }\n}\n//# sourceMappingURL=common.js.map","/* eslint-disable camelcase */\nimport { preparePublicKeyCredentialRequestOptions, preparePublicKeyCredential, decodeDOMException, } from './common';\nimport { L_WEBAUTHN_NOT_SUPPORTED, L_UNABLE_TO_GET_PK_CREDENTIAL } from './lang';\nfunction showError(error) {\n    const el = document.getElementById('login_error');\n    if (el && el.parentNode) {\n        el.parentNode.removeChild(el);\n    }\n    const form = document.getElementById('loginform');\n    if (form) {\n        form.insertAdjacentHTML('beforebegin', '<div id=\"login_error\" role=\"alert\"><p>' + error + '</p></div>');\n    }\n}\nfunction startAuthentication() {\n    const loginForm = document.getElementById('loginform');\n    const publicKey = preparePublicKeyCredentialRequestOptions(tfa_webauthn.options);\n    navigator.credentials.get({\n        publicKey,\n    })\n        .then((credential) => {\n        if (credential) {\n            document.getElementById('webauthn_response').value = JSON.stringify(preparePublicKeyCredential(credential));\n            loginForm.submit();\n        }\n        else {\n            throw new Error(L_UNABLE_TO_GET_PK_CREDENTIAL);\n        }\n    })\n        .catch((e) => {\n        const message = e instanceof DOMException ? decodeDOMException(e, true) : e.message;\n        showError(message);\n        document.getElementById('webauthn-retry').removeAttribute('hidden');\n    });\n}\nconst callback = () => {\n    const retryButton = document.querySelector('#webauthn-retry .button');\n    retryButton.addEventListener('click', (e) => {\n        document.getElementById('webauthn-retry').setAttribute('hidden', 'hidden');\n        startAuthentication();\n    });\n    if ('credentials' in navigator) {\n        if (!navigator.webdriver) {\n            startAuthentication();\n        }\n        else {\n            document.getElementById('webauthn-retry').removeAttribute('hidden');\n        }\n    }\n    else {\n        showError(L_WEBAUTHN_NOT_SUPPORTED);\n    }\n};\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', callback);\n}\nelse {\n    callback();\n}\n//# sourceMappingURL=login.js.map"],"names":["L_WEBAUTHN_NOT_SUPPORTED","__","L_UNABLE_TO_GET_PK_CREDENTIAL","L_NOT_ALLOWED_ERROR","L_SECURITY_ERROR","L_NOT_SUPPORTED_ERROR","L_ABORT_ERROR","L_UNKNOWN_KEY","L_KEY_ALREADY_REGISTERED","arrayToBase64String","a","window","btoa","String","fromCharCode","apply","base64UrlDecode","input","atob","replace","repeat","length","stringToBuffer","s","Uint8Array","from","c","charCodeAt","showError","error","el","document","getElementById","parentNode","removeChild","form","insertAdjacentHTML","startAuthentication","loginForm","publicKey","_a","_extends","challenge","allowCredentials","map","data","id","preparePublicKeyCredentialRequestOptions","tfa_webauthn","options","navigator","credentials","get","then","credential","Error","response","value","JSON","stringify","type","rawId","clientExtensionResults","getClientExtensionResults","attestationObject","undefined","authenticatorData","signature","userHandle","clientDataJSON","submit","e","DOMException","isAuth","name","message","decodeDOMException","removeAttribute","i18n","callback","querySelector","addEventListener","setAttribute","webdriver","readyState"],"mappings":"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"}